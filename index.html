<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Job Alignment Chart</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    textarea { width: 100%; height: 12em; margin-bottom: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: .5rem; text-align: left; }
    #form { display: block; }
  </style>
</head>
<body>
  <h1>Paste Your Markdown Table</h1>
  <div id="form">
    <textarea id="mdInput" placeholder="Paste the entire markdown table here"></textarea>
    <button onclick="onGenerate()">Generate & Share Link</button>
  </div>
  <div id="tableContainer"></div>

  <script>
    function parseMarkdownTable(md) {
      const lines = md.trim().split('\n');
      // find header and separator
      let headerLineIndex = lines.findIndex(line => /^\s*\|.*\|\s*$/.test(line));
      if (headerLineIndex < 0 || headerLineIndex + 1 >= lines.length) return null;
      let sepLine = lines[headerLineIndex + 1];
      if (!/^\s*\|?[-\s|:]+\|?\s*$/.test(sepLine)) return null;
      const header = lines[headerLineIndex]
        .replace(/^\s*\||\|\s*$/g, '')
        .split('|')
        .map(s => s.trim());
      const rows = [];
      for (let i = headerLineIndex + 2; i < lines.length; i++) {
        const line = lines[i];
        if (!/^\s*\|.*\|\s*$/.test(line)) break;
        const cols = line
          .replace(/^\s*\||\|\s*$/g, '')
          .split('|')
          .map(s => s.trim());
        rows.push(cols);
      }
      const tbl = document.createElement('table');
      const thead = tbl.createTHead().insertRow();
      header.forEach(text => {
        const th = document.createElement('th'); th.textContent = text; thead.appendChild(th);
      });
      const tbody = tbl.createTBody();
      rows.forEach(cols => {
        const row = tbody.insertRow();
        cols.forEach(text => {
          const cell = row.insertCell();
          cell.innerHTML = text;
        });
      });
      return tbl;
    }

    function onGenerate() {
      const md = document.getElementById('mdInput').value;
      const data = btoa(unescape(encodeURIComponent(md)));
      location.search = '?md=' + data;
    }

    window.onload = () => {
      const param = new URLSearchParams(location.search).get('md');
      if (param) {
        const md = decodeURIComponent(escape(atob(param)));
        document.getElementById('form').style.display = 'none';
        const table = parseMarkdownTable(md);
        if (table) {
          document.getElementById('tableContainer').appendChild(table);
        } else {
          document.getElementById('mdInput').value = md; // show input again
        }
      }
    };
  </script>
</body>
</html>
